<!DOCTYPE html>
<html lang="en"><!--
 __  __                __                                     __
/\ \/\ \              /\ \             __                    /\ \
\ \ \_\ \   __  __    \_\ \      __   /\_\      __       ___ \ \ \/'\
 \ \  _  \ /\ \/\ \   /'_` \   /'__`\ \/\ \   /'__`\    /'___\\ \ , <
  \ \ \ \ \\ \ \_\ \ /\ \L\ \ /\  __/  \ \ \ /\ \L\.\_ /\ \__/ \ \ \\`\
   \ \_\ \_\\/`____ \\ \___,_\\ \____\ _\ \ \\ \__/.\_\\ \____\ \ \_\ \_\
    \/_/\/_/ `/___/> \\/__,_ / \/____//\ \_\ \\/__/\/_/ \/____/  \/_/\/_/
                /\___/                \ \____/
                \/__/                  \/___/

Powered by Hydejack v9.2.1 <https://hydejack.com/>
-->







<head>
  






  
    
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Protohackers Challenge 00: Smoke Test in Rust and Setting up DigitalOcean | Mataiodoxia</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Protohackers Challenge 00: Smoke Test in Rust and Setting up DigitalOcean" />
<meta name="author" content="Lucas Masterson" />
<meta property="og:locale" content="en" />
<meta name="description" content="Problem Statement" />
<meta property="og:description" content="Problem Statement" />
<link rel="canonical" href="http://localhost:4000/blog/2025-06-14-2025-06-11-protohackers-00/" />
<meta property="og:url" content="http://localhost:4000/blog/2025-06-14-2025-06-11-protohackers-00/" />
<meta property="og:site_name" content="Mataiodoxia" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-06-14T14:25:34-07:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Protohackers Challenge 00: Smoke Test in Rust and Setting up DigitalOcean" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Lucas Masterson"},"dateModified":"2025-06-13T12:57:20-07:00","datePublished":"2025-06-14T14:25:34-07:00","description":"Problem Statement","headline":"Protohackers Challenge 00: Smoke Test in Rust and Setting up DigitalOcean","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/blog/2025-06-14-2025-06-11-protohackers-00/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/img_icon.png"},"name":"Lucas Masterson"},"url":"http://localhost:4000/blog/2025-06-14-2025-06-11-protohackers-00/"}</script>
<!-- End Jekyll SEO tag -->


  

  



  <meta name="color-scheme" content="dark light">



  <meta name="theme-color" content="rgb(25,55,71)">


<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta http-equiv="x-ua-compatible" content="ie=edge">

<meta name="mobile-web-app-capable" content="yes">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Mataiodoxia">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<meta name="application-name" content="Mataiodoxia">

<meta name="generator" content="Hydejack v9.2.1" />


<link rel="alternate" href="http://localhost:4000/blog/2025-06-14-2025-06-11-protohackers-00/" hreflang="en">

<link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Mataiodoxia" />


<link rel="shortcut icon"    href="/assets/icons/favicon.ico">
<link rel="apple-touch-icon" href="/assets/icons/icon-192x192.png">

<link rel="manifest" href="/assets/site.webmanifest">





<link rel="preload" href="/assets/img/swipe.svg" as="image" id="_hrefSwipeSVG">


  
  <link rel="dns-prefetch" href="/assets/bower_components/katex/dist/katex.min.css" id="_katexPreload">
  <noscript><link rel="stylesheet" href="/assets/bower_components/katex/dist/katex.min.css"></noscript>





<script>((r,a)=>{function d(e,t,n,o){e.addEventListener?e.addEventListener(t,n,o):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}r.loadJS=function(e,t){var n=a.createElement("script"),e=(n.src=e,t&&d(n,"load",t,{once:!0}),a.scripts[0]);return e.parentNode.insertBefore(n,e),n},r._loaded=!1,r.loadJSDeferred=function(e,t){var n=a.createElement("script");function o(){r._loaded=!0,t&&d(n,"load",t,{once:!0});var e=a.scripts[0];e.parentNode.insertBefore(n,e)}return n.src=e,r._loaded?o():d(r,"load",o,{once:!0}),n},r.setRel=r.setRelStylesheet=function(e){d(a.getElementById(e),"load",function(){this.rel="stylesheet"},{once:!0})}})(window,document);
!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);
!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);
!function(w) {
  w._baseURL = '/';
  w._publicPath = '/assets/js/';
  w._noPushState = false;
  w._noDrawer = false;
  w._noNavbar = false;
  w._noToc = false;
  w._noSearch = false;
  w._search = {
    DATA_URL: '/assets/sitedata.json?no-cache',
    STORAGE_KEY: 'mini-search/',
    INDEX_KEY: 'index--2025-06-14T14:25:34-07:00',
  };
  w._clapButton = true;
}(window);</script>



<!--[if gt IE 8]><!---->

  




<link rel="stylesheet" href="/assets/css/hydejack-9.2.1.css" id="_stylePreload">
<link rel="stylesheet" href="/assets/icomoon/style.css" id="_iconsPreload">




  <style id="_pageStyle">

html{--accent-color: rgb(79,177,186);--accent-color-faded: rgba(79, 177, 186, 0.5);--accent-color-highlight: rgba(79, 177, 186, 0.1);--accent-color-darkened: rgb(63.8602040816, 154.5602040816, 162.8897959184);--theme-color: rgb(25,55,71);--dark-mode-body-bg: hsl(200.8695652174, 5.9895833333%, 17.5%);--dark-mode-border-color: hsl(200.8695652174, 5.9895833333%, 22.5%)}
</style>


<!--<![endif]-->


<!-- Add HTML tags here to be included in the head. You can delete the below: -->
<link rel="dns-prefetch" href="https://assets.gumroad.com">
<script type="module">
  const loadJS = x => new Promise(r => window.loadJS(x).addEventListener('load', r));

  let p1, p2, io1, io2, embedCreated, overlayCreated;
  document.querySelector('hy-push-state').addEventListener('load', () => {
    io1 ||= new IntersectionObserver(async (entries) => {
      if (entries.some(x => x.isIntersecting)) {
        p1 = p1 || loadJS('https://gumroad.com/js/gumroad-embed.js');
        await p1;
        !embedCreated && await new Promise(function check1(res) {
          if (typeof createGumroadEmbed !== 'undefined')  {
            embedCreated = 1;
            res(createGumroadEmbed());
          }
          else setTimeout(() => check1(res), 200);
        });
        await new Promise(function check2(res) {
          if (typeof GumroadEmbed !== 'undefined') res(GumroadEmbed.reload());
          else setTimeout(() => check2(res), 200);
        });
      }
    }, { rootMargin: '1440px' });

    io2 ||= new IntersectionObserver(async (entries) => {
      if (entries.some(x => x.isIntersecting)) {
        p2 = p2 || loadJS('https://gumroad.com/js/gumroad.js');
        await p2;
        !overlayCreated && await new Promise(function check(res) {
          if (typeof createGumroadOverlay !== 'undefined') {
            overlayCreated = 1;
            res(createGumroadOverlay());
          }
          else setTimeout(() => check(res), 200);
        });
      }
    }, { rootMargin: '300px' });

    document.querySelectorAll('.gumroad-product-embed').forEach(el => io1.observe(el));
    document.querySelectorAll('.gumroad-button').forEach(el => io2.observe(el));
  });
</script>


</head>

<body class="no-break-layout">
  
<script>
  window._sunrise = 6;
  window._sunset =  18;
  ((e,s)=>{var d="light-mode",a="dark-mode",o=(new Date).getHours();"matchMedia"in e&&e.matchMedia("(prefers-color-scheme)")||(e=(o=o<=e._sunrise||o>=e._sunset?a:d)==a?d:a,s.body.classList.add(o),s.body.classList.remove(e))})(window,document);

</script>



<hy-push-state
  id="_pushState"
  replace-selector="#_main"
  link-selector="a[href]:not([href^='/assets/']):not(.external):not(.no-push-state)"
  script-selector="script"
  duration="500"
  hashchange
>
  
  
  <div id="_navbar" class="navbar fixed-top">
  <div class="content">
    <span class="sr-only">Jump to:</span>
    <div class="nav-btn-bar">
      <a id="_menu" class="nav-btn no-hover" href="#_drawer--opened">
        <span class="sr-only">Navigation</span>
        <span class="icon-menu"></span>
      </a>
      <div class="nav-span"></div>
    </div>
  </div>
</div>
<hr class="sr-only" hidden />

  <main
  id="_main"
  class="content layout-post"
  role="main"
>
  <nav id="breadcrumbs" class="screen-only"><ul>
  
  
    <li><a href="/">home</a></li>
    
      <li>
        
          <span>/</span>
          
          
          <a href="/blog/">blog</a>
        
      </li>
    
      <li>
        
          <span>/</span>
          <span>2025-06-14-2025-06-11-protohackers-00</span>
        
      </li>
    
  
</ul></nav>
  










<article id="post-blog-2025-06-11-protohackers-00" class="page post mb6" role="article">
  <header>
    <h1 class="post-title flip-project-title">
      
        Protohackers Challenge 00: Smoke Test in Rust and Setting up DigitalOcean
      
    </h1>

    <div class="post-date">
      
      <span class="ellipsis mr1">
        <time datetime="2025-06-14T14:25:34-07:00">14 Jun 2025</time> in <span>Blog</span> 
      </span>
      
        
          
          
          
            
            
            <span class="ellipsis" data-tippy-content="Last modified at: 13 Jun 2025">
              <span class="sr-only">Last modified at:</span>
              <span class="icon-history"></span>
              <time datetime="2025-06-13T12:57:20-07:00">2025-06-13</time>
            </span>
          
        
      
    </div>

    
    

    



  <div class="hr pb0"></div>


  </header>

  
    <h2 id="problem-statement"><a href="https://protohackers.com/problem/0">Problem Statement</a></h2>

<blockquote>
0: Smoke Test <br /><br />

Deep inside Initrode Global's enterprise management framework lies a component that writes data to a server and expects to read the same data back. (Think of it as a kind of distributed system delay-line memory). We need you to write the server to echo the data back. <br /><br />

Accept TCP connections. <br /><br />

Whenever you receive data from a client, send it back unmodified. <br /><br />

Make sure you don't mangle binary data, and that you can handle at least 5 simultaneous clients. <br /><br />

Once the client has finished sending data to you it shuts down its sending side. Once you've reached end-of-file on your receiving side, and sent back all the data you've received, close the socket so that the client knows you've finished. (This point trips up a lot of proxy software, such as ngrok; if you're using a proxy and you can't work out why you're failing the check, try hosting your server in the cloud instead). <br /><br />

Your program will implement the TCP Echo Service from RFC 862.
</blockquote>

<h2 id="hosting-a-server">Hosting a Server</h2>

<p>The most important problem at hand is to figure out whether I want to host this server locally or on some VPS. I recently came to find out that my GitHub Education License actually provides me $200 worth of credits for DigitalOcean.</p>

<p>I went onto DigitalOcean, opened an account, and set up a VM:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">2 GB Memory / 1 AMD vCPU / 50 GB Disk / SFO3 - Ubuntu 24.10 x64
</span></code></pre></div></div>

<p>For our task, these specs are completely fine (if you actually write safe code, as you’ll see when I try to solve later iterations of the challenges). As with all open ports on the internet, it was caught in massive netscans and promptly attacked by dozens of other IPs trying to authenticate. To combat this, I set up <code class="language-plaintext highlighter-rouge">ufw</code> and <code class="language-plaintext highlighter-rouge">fail2ban</code> to drop all connections not from explicitly defined IPs and to ban IPs that tried to authenticate incorrectly more than 3 times.</p>

<p>Initially, I did have trouble with my first two droplets, which I ended up bricking or screwing up network settings pretty badly. I ended up destroying those droplets and setting up the one mentioned above.</p>

<p>My updated config:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">root@rs-protohackers:~#</span><span class="w"> </span>ufw status verbose
<span class="go">Status: active
Logging: on (low)
Default: deny (incoming), allow (outgoing), disabled (routed)
New profiles: skip

To                         Action      From
--                         ------      ----
</span><span class="gp">22/tcp                     ALLOW IN    &lt;My IP&gt;</span><span class="w">
</span><span class="gp">4040/tcp                   ALLOW IN    &lt;My IP&gt;</span><span class="w">
</span><span class="go">22/tcp                     ALLOW IN    206.189.113.124
4040/tcp                   ALLOW IN    206.189.113.124
</span></code></pre></div></div>

<h2 id="solving-the-task">Solving the Task</h2>

<p>I decided to write this simple TCP echo server using Rust’s <code class="language-plaintext highlighter-rouge">std::net</code> library which provides <code class="language-plaintext highlighter-rouge">TcpListener</code> and <code class="language-plaintext highlighter-rouge">TcpStream</code>, and run these on spawned threads – which, frankly, is a really bad design choice, but the level of testing this first challenge performs won’t cause anything too unfavorable to happen.</p>

<div class="language-rs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">net</span><span class="p">::{</span><span class="n">TcpListener</span><span class="p">,</span> <span class="n">TcpStream</span><span class="p">};</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">io</span><span class="p">::{</span><span class="n">Read</span><span class="p">,</span> <span class="n">Write</span><span class="p">};</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">thread</span><span class="p">;</span>
</code></pre></div></div>

<p>Let’s write our main function and generate a listener.</p>

<div class="language-rs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pub</span> <span class="k">fn</span> <span class="nf">run</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="nn">std</span><span class="p">::</span><span class="nn">io</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"Port opened on 4040"</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">listener</span> <span class="o">=</span> <span class="nn">TcpListener</span><span class="p">::</span><span class="nf">bind</span><span class="p">(</span><span class="s">"0.0.0.0:4040"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

    <span class="k">for</span> <span class="n">stream</span> <span class="k">in</span> <span class="n">listener</span><span class="nf">.incoming</span><span class="p">()</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"Received stream from {:?}"</span><span class="p">,</span> <span class="n">stream</span><span class="p">);</span>
        <span class="nf">handle_client</span><span class="p">(</span><span class="n">stream</span><span class="o">?</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nf">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</code></pre></div></div>

<p>I wrote this function in a <code class="language-plaintext highlighter-rouge">pub fn run() -&gt; std::io::Result&lt;()&gt;</code> because I’ve attached it to a larger crate where I can specify which challenge to run: <code class="language-plaintext highlighter-rouge">cargo r 0</code>. I’m working on improving the modularity and placing each challenge in a different crate, but we’re getting there. For the scope of this first task, this approach is completely fine.</p>

<p>Now as for how the code works:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">pub fn run() -&gt; std::io::Result&lt;()&gt;</code> will act as our de facto <code class="language-plaintext highlighter-rouge">main()</code> function, and returns a <code class="language-plaintext highlighter-rouge">Result</code> which will tell us whether our program panics or successful completes (returns an <code class="language-plaintext highlighter-rouge">Ok(())</code>).</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">let listener = TcpListener::bind("0.0.0.0:4040")?;</code> tells the program to open a port with full access from the internet on port <code class="language-plaintext highlighter-rouge">4040</code>. We require the <code class="language-plaintext highlighter-rouge">?</code> to handle the <code class="language-plaintext highlighter-rouge">Result</code> returned by <code class="language-plaintext highlighter-rouge">bind()</code> quietly.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">for stream in listener.incoming() {}</code> just catches each stream opened to our port and allows us to iterate over them.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">handle_client(stream?);</code> is a user defined function that will contain our code to handle the “echo” part of our TCP echo server.</p>
  </li>
</ul>

<p>For <code class="language-plaintext highlighter-rouge">handle_client()</code>:</p>

<div class="language-rs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fn</span> <span class="nf">handle_client</span><span class="p">(</span><span class="k">mut</span> <span class="n">stream</span><span class="p">:</span> <span class="n">TcpStream</span><span class="p">)</span> <span class="p">{</span>
    <span class="nn">thread</span><span class="p">::</span><span class="nf">spawn</span><span class="p">(</span><span class="k">move</span> <span class="p">||</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">buffer</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">;</span> <span class="mi">1024</span><span class="p">];</span>
        <span class="k">loop</span> <span class="p">{</span>
            <span class="k">match</span> <span class="n">stream</span><span class="nf">.read</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">buffer</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">Ok</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
                    <span class="nd">println!</span><span class="p">(</span><span class="s">"Connection close"</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nf">Ok</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="k">let</span> <span class="nf">Err</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">=</span> <span class="n">stream</span><span class="nf">.write_all</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buffer</span><span class="p">[</span><span class="o">..</span><span class="n">n</span><span class="p">])</span> <span class="p">{</span>
                        <span class="nd">eprintln!</span><span class="p">(</span><span class="s">"Write error: {:?}"</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="nf">Err</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
                    <span class="nd">eprintln!</span><span class="p">(</span><span class="s">"Read error: {:?}"</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>
    <p>We take a parameter <code class="language-plaintext highlighter-rouge">mut stream: TcpStream</code>, which is our TCP stream (as the name suggests). We need to take this mutably so we can edit data in the stream to render to the sender.</p>
  </li>
  <li>
    <p>Now for the “unsafe” part of this code. We use <code class="language-plaintext highlighter-rouge">thread::spawn()</code> to spawn threads for each stream taken up by our TCP server, allocating a lot of resource to handle each request (I say “for each stream” because we’re executing this function in the <code class="language-plaintext highlighter-rouge">for</code> loop of the <code class="language-plaintext highlighter-rouge">run()</code> function).</p>
  </li>
  <li>
    <p>We then make a buffer object: <code class="language-plaintext highlighter-rouge">let mut buffer: [u8; 1024] = [0; 1024]</code>, which is a <code class="language-plaintext highlighter-rouge">1024</code> byte array. The <code class="language-plaintext highlighter-rouge">[u8; 1024]</code> part is actually implicit because the Rust compiler is smart and understands we are trying to write raw bytes. Anyhow, this <code class="language-plaintext highlighter-rouge">buffer</code> will allow us to write raw data into it.</p>
  </li>
  <li>
    <p>For each thread spawned, we do a <code class="language-plaintext highlighter-rouge">loop</code> until termination. In this loop, we’re handling the request of the sender. We use a <code class="language-plaintext highlighter-rouge">match stream.read(&amp;mut buffer) {}</code> to read requests. The <code class="language-plaintext highlighter-rouge">read()</code> function reads data from the stream into some parameter variable, which we’ve set as a mutable reference to <code class="language-plaintext highlighter-rouge">buffer</code>. So, for the stream, we’re reading its data mutably into our <code class="language-plaintext highlighter-rouge">buffer</code> variable.</p>
  </li>
  <li>
    <p>We have three branches for our <code class="language-plaintext highlighter-rouge">match</code> statement, so let’s go over them individually.</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">Ok(0) =&gt; { break; }</code> indicates an EOF (end of file). The problem statements tells us to break the connection and return the data our server received. You might have noticed that in this branch we’re not actually returning any data? Well, that’s because if we’re at an EOF, we’ve already returned all the data we need to, so we just have to close the connection as we’ll see in the second branch.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">Ok(n) =&gt; { }</code> is where we actually receive data that can be read. The <code class="language-plaintext highlighter-rouge">n</code> is a <code class="language-plaintext highlighter-rouge">usize</code> that tells us the number of bytes of data that were read from the stream. The ensuing <code class="language-plaintext highlighter-rouge">if let Err(e) = stream.write_all(&amp;buffer[..n]) {}</code> basically says “if writing into the stream fails, do the thing in the if statement,” which is to write an error connection and break the message. The “default” behavior, I guess you could say, is to <code class="language-plaintext highlighter-rouge">write_all</code> into the buffer. Except, if we just write into <code class="language-plaintext highlighter-rouge">&amp;buffer</code>, we don’t know how many bytes we’re supposed to be writing in, leading to some memory issues. It follows that we must specify how many bytes we want to write, which turns out the be editing the first <code class="language-plaintext highlighter-rouge">n</code> bytes of that <code class="language-plaintext highlighter-rouge">buffer</code> using the <code class="language-plaintext highlighter-rouge">[..n]</code>.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">Err(e) =&gt; { }</code> just tells us that if we have an error reading the stream, print an error message and break the connection.</p>
      </li>
    </ul>
  </li>
</ul>

<p>And thus, that concludes our code!</p>

<h2 id="test">Test</h2>

<p>Let’s open the server:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">root@rs-protohackers:~/tcp#</span><span class="w"> </span>cargo r 1
<span class="go">    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.02s
     Running `target/debug/challenges 1`
Port opened on 4040
</span></code></pre></div></div>

<p>Then trying using <code class="language-plaintext highlighter-rouge">netcat</code> to connect to port 4040 + run a few echo tests:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">parallaxis@ASOOS:~$</span><span class="w"> </span>nc 24.144.82.153 4040
<span class="go">a
a
hello
hello
^C
</span><span class="gp">parallaxis@ASOOS:~$</span><span class="w">
</span></code></pre></div></div>

<p>The echo tests worked!</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">root@rs-protohackers:~/tcp#</span><span class="w"> </span>cargo r 1
<span class="go">    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.02s
     Running `target/debug/challenges 1`
Port opened on 4040
Received stream from Ok(TcpStream { addr: 24.144.82.153:4040, peer: 68.248.128.73:50168, fd: 10 })
Connection close
^C
</span><span class="gp">root@rs-protohackers:~/tcp#</span><span class="w">
</span></code></pre></div></div>

<p>Nice! Now let’s run it against the actual testcases.</p>

<h2 id="results">Results</h2>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">root@rs-protohackers:~/tcp#</span><span class="w"> </span>./target/release/challenges 1
<span class="go">Port opened on 4040
Received stream from Ok(TcpStream { addr: 24.144.82.153:4040, peer: 206.189.113.124:42500, fd: 10 })
Connection close
Received stream from Ok(TcpStream { addr: 24.144.82.153:4040, peer: 206.189.113.124:42502, fd: 11 })
Connection close
Received stream from Ok(TcpStream { addr: 24.144.82.153:4040, peer: 206.189.113.124:42504, fd: 10 })
Connection close
Received stream from Ok(TcpStream { addr: 24.144.82.153:4040, peer: 206.189.113.124:42506, fd: 11 })
Connection close
Received stream from Ok(TcpStream { addr: 24.144.82.153:4040, peer: 206.189.113.124:42510, fd: 10 })
Received stream from Ok(TcpStream { addr: 24.144.82.153:4040, peer: 206.189.113.124:42512, fd: 11 })
Received stream from Ok(TcpStream { addr: 24.144.82.153:4040, peer: 206.189.113.124:42514, fd: 12 })
Received stream from Ok(TcpStream { addr: 24.144.82.153:4040, peer: 206.189.113.124:42516, fd: 13 })
Received stream from Ok(TcpStream { addr: 24.144.82.153:4040, peer: 206.189.113.124:42518, fd: 14 })
Connection close
Connection close
Connection close
Connection close
Connection close
</span></code></pre></div></div>

<p><img src="/assets/img/protohackers-0-results.png" alt="Protohackers Results 0: PASS" /></p>

  
</article>



  <hr class="dingbat related mb6" />






  
     


  <aside class="about related mt4 mb4" role="complementary">
    
    

<div class="author mt4">
  

  
    


<img
  
    src="/assets/img/parallaxes_pfp.png"
    srcset="https://via.placeholder.com/128x128 1x,/assets/img/parallaxes_pfp.png 2x"
    
  
  alt="Lucas Masterson"
  class="avatar"
  
  width="120"
  height="120"
  loading="lazy"
/>

  

  
  
  <h2  class="page-title hr-bottom">
    About
  </h2>

  <p>I like Rust.</p>


  <div class="sidebar-social">
    <span class="sr-only">Social:</span>
<ul>
  
    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://github.com/Parallaxes" title="GitHub" class="no-mark-external">
      <span class="icon-github"></span>
      <span class="sr-only">GitHub</span>
    </a>
  </li>


    
  
</ul>

  </div>
</div>

  </aside>


  

  
  

  
    


  <aside class="related mb4" role="complementary">  <h2 class="hr-bottom">Related Posts</h2>  <ul class="related-posts">                  <li class="h4">  <a href="/blog/2025-06-14-2025-06-14-protohackers-01/" class="flip-title"><span>Protohackers Challenge 01: Prime Time in Rust</span></a>  <time class="faded fine" datetime="2025-06-14T14:25:34-07:00">14 Jun 2025</time></li>                        <li class="h4">  <a href="/blog/2025-06-09-nsa-backdoor-rsa/" class="flip-title"><span>How the NSA Probably Backdoored RSA</span></a>  <time class="faded fine" datetime="2025-06-09T00:00:00-07:00">09 Jun 2025</time></li>            </ul></aside>

  

  
  

  
    

  


  
<footer class="content" role="contentinfo">
  <hr/>
  
    <p><small class="copyright">© 2024. All rights reserved.
</small></p>
  
  
    <nav class="legal"><small>
    
      
      <a class="heading flip-title" href="/LICENSE/">LICENSE</a>
      |
    
      
      <a class="heading flip-title" href="/NOTICE/">NOTICE</a>
      |
    
      
      <a class="heading flip-title" href="/CHANGELOG/">CHANGELOG</a>
      
    
    </small></nav>
  
    <p><small>Powered by <a class="external" href="https://hydejack.com/">Hydejack</a> v<span id="_version">9.2.1</span></small></p>
  <hr class="sr-only"/>
</footer>


</main>

  <hy-drawer
  id="_drawer"
  class=""
  side="left"
  threshold="10"
  noscroll
  
>
  <header id="_sidebar" class="sidebar" role="banner">
    




<div class="sidebar-bg sidebar-overlay" style="background-color:rgb(25,55,71);background-image:url(/assets/img/sidebar.jpg)"></div>

    <div class="sidebar-sticky">
  <div class="sidebar-about">
    
      <a class="no-hover" href="/" tabindex="-1">
        <img src="/assets/img_icon.png" class="avatar" alt="Mataiodoxia" width="120" height="120" loading="lazy" />
      </a>
    
    <a class="sidebar-title" href="/"><h2 class="h1">Mataiodoxia</h2></a>
    
    
      <p class="">
        A personal blog site for code, math, and privacy.

      </p>
    
  </div>

  <nav class="sidebar-nav heading" role="navigation">
    <span class="sr-only">Navigation:</span>
<ul>
  
    
      
      <li>
        <a
          id="_drawer--opened"
          href="/blog/"
          class="sidebar-nav-item "
          
        >
          Blog
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/docs/"
          class="sidebar-nav-item "
          
        >
          Documentation
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/about/"
          class="sidebar-nav-item "
          
        >
          About
        </a>
      </li>
    
  
</ul>

  </nav>

  
  <div class="sidebar-social">
    <span class="sr-only">Social:</span>
<ul>
  
    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://github.com/Parallaxes" title="GitHub" class="no-mark-external">
      <span class="icon-github"></span>
      <span class="sr-only">GitHub</span>
    </a>
  </li>


    
  
</ul>

  </div>
</div>
  </header>
</hy-drawer>
<hr class="sr-only" hidden />

</hy-push-state>


  <!--[if gt IE 10]><!---->
  <script nomodule>(()=>{var t,n=document.createElement("script");!("noModule"in n)&&"onbeforeload"in n&&(t=!1,document.addEventListener("beforeload",function(e){if(e.target===n)t=!0;else if(!e.target.hasAttribute("nomodule")||!t)return;e.preventDefault()},!0),n.type="module",n.src=".",document.head.appendChild(n),n.remove())})();
</script>
  <script src="/assets/js/hydejack-9.2.1.js" type="module"></script>
  <script src="/assets/js/LEGACY-hydejack-9.2.1.js" nomodule defer></script>
  

  

<!--<![endif]-->
  <!--
Code for integrating CloudFlare's email protection with Hydejack's single page app loading.
-->
<script>
  document.getElementById('_pushState').addEventListener('hy-push-state-after', function (e) {
    function e(e){
      (console.error?console.error:console.log).call(console,e)
    }

    function t(e){
      return l.innerHTML='<a href="'+e.replace(/"/g,"&quot;")+'"></a>',l.childNodes[0].getAttribute("href")
    }

    function r(e,t){
      var r=e.substr(t,2);return parseInt(r,16)
    }

    function n(e,n){
      for(var o="",c=r(e,n),a=n+2;a<e.length;a+=2){
        var l=r(e,a)^c;
        o+=String.fromCharCode(l)
      }
      return t(o)
    }

    var o="/cdn-cgi/l/email-protection#",
        c=".__cf_email__",
        a="data-cfemail",
        l=document.createElement("div");

    !function(){
      for(var t=document.getElementsByTagName("a"),r=0;r<t.length;r++)
        try{
          var c=t[r],a=c.href.indexOf(o);
          a>-1&&(c.href="mailto:"+n(c.href,a+o.length))
        }catch(t){
          e(t)
        }
    }(),
    function(){
      for(var t=document.querySelectorAll(c),r=0;r<t.length;r++)
        try{
          var o=t[r],l=n(o.getAttribute(a),0),i=document.createTextNode(l);
          o.parentNode.replaceChild(i,o)
        }catch(t){
          e(t)
        }
    }()
  });
</script>





<div hidden>
  
  <h2 class="sr-only">Templates (for web app):</h2>

  <template id="_animation-template">
  <div class="animation-main fixed-top">
    <nav id="breadcrumbs" class="screen-only"><ul>
  
  
</ul></nav>
    <div class="content">
      <div class="page"></div>
    </div>
  </div>
</template>

  <template id="_loading-template">
  <div class="loading nav-btn fr">
    <span class="sr-only">Loading…</span>
    <span class="icon-cog"></span>
  </div>
</template>

  <template id="_error-template">
  <div class="page">
    <h1 class="page-title">Error</h1>
    
    
    <p class="lead">
      Sorry, an error occurred while loading <a class="this-link" href=""></a>.

    </p>
  </div>
</template>

  <template id="_permalink-template">
  <a href="#" class="permalink">
    <span class="sr-only">Permalink</span>
    <span class="content-hash"></span>
  </a>
</template>

  
    <template id="_dark-mode-template">
  <button id="_dark-mode" class="nav-btn no-hover" >
    <span class="sr-only">Dark Mode</span>
    <span class="icon-brightness-contrast"></span>
  </button>
</template>

  
</div>


</body>
</html>
